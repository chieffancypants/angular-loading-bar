/*! 
 * angular-loading-bar v0.5.0
 * https://chieffancypants.github.io/angular-loading-bar
 * Copyright (c) 2014 Wes Cruver
 * License: MIT
 */
(function(){'use strict';angular.module('angular-loading-bar',['cfp.loadingBarInterceptor']);angular.module('chieffancypants.loadingBar',['cfp.loadingBarInterceptor']);angular.module('cfp.loadingBarInterceptor',['cfp.loadingBar']).config(['$httpProvider',function($httpProvider){var interceptor=['$q','$cacheFactory','$timeout','$rootScope','cfpLoadingBar',function($q,$cacheFactory,$timeout,$rootScope,cfpLoadingBar){var reqsTotal=0;var reqsCompleted=0;var latencyThreshold=cfpLoadingBar.latencyThreshold;var startTimeout;function setComplete(){$timeout.cancel(startTimeout);cfpLoadingBar.complete();reqsCompleted=0;reqsTotal=0;}
function isCached(config){var cache;var defaults=$httpProvider.defaults;if(config.method!=='GET'||config.cache===false){config.cached=false;return false;}
if(config.cache===true&&defaults.cache===undefined){cache=$cacheFactory.get('$http');}else if(defaults.cache!==undefined){cache=defaults.cache;}else{cache=config.cache;}
var cached=cache!==undefined?cache.get(config.url)!==undefined:false;if(config.cached!==undefined&&cached!==config.cached){return config.cached;}
config.cached=cached;return cached;}
return{'request':function(config){if(!config.ignoreLoadingBar&&!isCached(config)){$rootScope.$broadcast('cfpLoadingBar:loading',{url:config.url});if(reqsTotal===0){startTimeout=$timeout(function(){cfpLoadingBar.start();},latencyThreshold);}
reqsTotal++;cfpLoadingBar.set(reqsCompleted/reqsTotal);}
return config;},'response':function(response){if(!response.config.ignoreLoadingBar&&!isCached(response.config)){reqsCompleted++;$rootScope.$broadcast('cfpLoadingBar:loaded',{url:response.config.url});if(reqsCompleted>=reqsTotal){setComplete();}else{cfpLoadingBar.set(reqsCompleted/reqsTotal);}}
return response;},'responseError':function(rejection){if(!rejection.config.ignoreLoadingBar&&!isCached(rejection.config)){reqsCompleted++;$rootScope.$broadcast('cfpLoadingBar:loaded',{url:rejection.config.url});if(reqsCompleted>=reqsTotal){setComplete();}else{cfpLoadingBar.set(reqsCompleted/reqsTotal);}}
return $q.reject(rejection);}};}];$httpProvider.interceptors.push(interceptor);}]);angular.module('cfp.loadingBar',[]).provider('cfpLoadingBar',function(){this.includeSpinner=true;this.includeBar=true;this.latencyThreshold=100;this.startSize=0.02;this.parentSelector='body';this.loadingBarTemplate='<div id="loading-bar"><div class="loadingBar"><div class="peg"></div></div></div>';this.spinnerTemplate='<div id="loading-bar-spinner"><div class="spinner-icon"></div></div>';this.$get=['$document','$timeout','$animate','$rootScope',function($document,$timeout,$animate,$rootScope){var $parentSelector=this.parentSelector,loadingBarContainer=angular.element(this.loadingBarTemplate),loadingBar=loadingBarContainer.find('div').eq(0),spinner=angular.element(this.spinnerTemplate);var incTimeout,completeTimeout,started=false,status=0;var includeSpinner=this.includeSpinner;var includeBar=this.includeBar;var startSize=this.startSize;function _start(){var $parent=$document.find($parentSelector);$timeout.cancel(completeTimeout);if(started){return;}
$rootScope.$broadcast('cfpLoadingBar:started');started=true;if(includeBar){$animate.enter(loadingBarContainer,$parent);}
if(includeSpinner){$animate.enter(spinner,$parent);}
_set(startSize);}
function _set(n){if(!started){return;}
var pct=(n*100)+'%';loadingBar.css('width',pct);status=n;$timeout.cancel(incTimeout);incTimeout=$timeout(function(){_inc();},250);}
function _inc(){if(_status()>=1){return;}
var rnd=0;var stat=_status();if(stat>=0&&stat<0.25){rnd=(Math.random()*(5-3+1)+3)/100;}else if(stat>=0.25&&stat<0.65){rnd=(Math.random()*3)/100;}else if(stat>=0.65&&stat<0.9){rnd=(Math.random()*2)/100;}else if(stat>=0.9&&stat<0.99){rnd=0.005;}else{rnd=0;}
var pct=_status()+rnd;_set(pct);}
function _status(){return status;}
function _complete(){$rootScope.$broadcast('cfpLoadingBar:completed');_set(1);$timeout.cancel(completeTimeout);completeTimeout=$timeout(function(){$animate.leave(loadingBarContainer,function(){status=0;started=false;});$animate.leave(spinner);},500);}
return{start:_start,set:_set,status:_status,inc:_inc,complete:_complete,includeSpinner:this.includeSpinner,latencyThreshold:this.latencyThreshold,parentSelector:this.parentSelector,startSize:this.startSize};}];});})();